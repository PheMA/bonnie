<div class="patient-bank">

  <div class="bank-measure">
    <h1>{{#link "measures/{{hqmf_set_id}}" expand-tokens=true}}<i class="fa fa-arrow-circle-left" aria-hidden="true"></i> {{cms_id}}{{/link}}</h1>
    {{view bankLogicView}}
  </div>

  <div class="bank-patients">
    <h1>Filters</h1>
    {{#collection appliedFilters class="existing-filters" item-context=appliedFilterContext}}
      <span class="added-filter">
        {{ label }}
        {{#button "removeFilter" class="btn btn-link close delete"}}&times; <span class="sr-only">Delete</span>{{/button}}
      </span>
    {{/collection}}

    <form class="patient-filters form-inline">
      <div class="form-group">
        <label for='patients-filter' class="sr-only">Filter the results below by measure population, measure ID, or user email.</label>
        {{#collection availableFilters tag='select' name='patients-filter' id='patients-filter' class='form-control selectBoxIt-native'}}
          <option>{{name}}</option>
        {{/collection}}
      </div>
      <div class="form-group additional-requirements"></div>
      <button type="submit" class="btn btn-primary" data-ready-text='<i class="fa fa-plus" aria-hidden="true"></i>' disabled="true">
        Loading patients...
        <span class="sr-only">add code</span>
      </button>
    </form>

    <div class="patients-results">
      <h1 class="pull-left">Results <span class="patient-count"></span></h1>

      <div class="pull-right">
        <span class="patient-select-count"></span>
        {{#button "cloneBankPatients" class="btn btn-default bank-actions" data-cloning-text="Cloning..." data-cloned-text="Cloned successfully" disabled="true"}}Clone into {{cms_id}}<span class="sr-only"> patients selected from patient bank</span>{{/button}}
      </div>

    </div>

    {{#collection differences id="sharedResults" class="patient-results panel-group" item-context=differenceContext item-filter=patientFilter}}
      <div class="panel panel-default shared-patient">
        <div class="panel-heading">
          <div class="panel-title">
            <div class="patient">
              <div class="patient-checkbox">
                <label>
                  <span class="sr-only">Select {{patient.last}} {{patient.first}}</span>
                  <input type="checkbox" class="select-patient">
                </label>
              </div>
              <div class="patient-user-icon">
                <i class="fa fa-user" aria-hidden="true"></i><span class="sr-only">{{patient.last}} {{patient.first}}, patient result</span>
              </div>
              <div class="patient-btn">
                <a data-toggle="collapse" data-parent="#sharedResults" href="#toggle{{@cid}}" class="close">
                  <i class="fa fa-lg panel-chevron fa-angle-right expand-result-icon expand-result-icon-{{patient._id}}" aria-hidden="true"></i>
                  <span class="sr-only">{{patient.last}} {{patient.first}}, Toggle Logic Pass/Fail</span>
                </a>
              </div>
              <div class="patient-status status status-{{status}}">
                <span class="sr-only">{{patient.last}} {{patient.first}}, status </span>{{status}}
              </div>
              <div class="patient-name">
                <span class="sr-only">patient name: </span>{{patient.last}} {{patient.first}}
              </div>

            </div>
          </div>
        </div>
        <div id="toggle{{@cid}}" class="panel-collapse collapse">
          <div class="panel-body">
            {{template "population_calculation_results"}}
            {{#button "clonePatient" class="btn btn-primary"}}CLONE<span class="sr-only"> patient {{patient.last}} {{patient.first}}</span>{{/button}}
          </div>
        </div>
      </div>
    {{/collection}}

  </div>
</div>
