<div class="patient-bank">

  <div class="bank-measure">
    <h1>{{cms_id}}</h1>
    {{view bankLogicView}}
  </div>

  <div class="bank-patients">
    <h1>Filters</h1>
    {{#collection appliedFilters class="existing-filters" item-context=appliedFilterContext}}
      <span class="added-filter">
        {{label}}
        {{#button "removeFilter" class="btn btn-link close delete"}}&times; <span class="sr-only">Delete</span>{{/button}}
      </span>
    {{/collection}}

    <form class="form-inline patient-filters">
      {{#collection availableFilters tag='select' name='patients-filter' class='form-control'}}
        <option>{{name}}</option>
      {{/collection}}

      <button type="submit" class="btn btn-primary">
        <i class="fa fa-plus" aria-hidden="true"></i>
        <span class="sr-only">add code</span>
      </button>
    </form>

    <div class="patients-results">
      <h1 class="pull-left">Results</h1>

      <div class="pull-right">
        {{#button "cloneBankPatients" class="btn btn-default"}}Clone<span class="sr-only"> patients selected from patient bank</span>{{/button}}
        {{#button "exportBankPatients" class="btn btn-primary"}}Export All<span class="sr-only"> patients selected from patient bank</span>{{/button}}
      </div>

    </div>

    {{#collection differences id="sharedResults" class="patient-results panel-group" item-context=differenceContext item-filter=differenceFilter}}
      <div class="panel panel-default shared-patient">
        <div class="panel-heading">
          <div class="panel-title">
            <div class="patient">
              <div class="patient-checkbox">
                <label>
                  <span class="sr-only">Select {{patient.last}} {{patient.first}}</span>
                  <input type="checkbox" value="{{patient._id}}" class="select-patient">
                </label>
              </div>
              <div class="patient-status-icon status status-{{status}}">
                {{#if ../patientsListing}}
                {{else}}
                  {{#if done}}
                    {{#if match}}
                      <i class="fa fa-check" aria-hidden="true"></i><span class="sr-only">{{patient.last}} {{patient.first}}, patient passing</span>
                    {{else}}
                      <i class="fa fa-times" aria-hidden="true"></i><span class="sr-only">{{patient.last}} {{patient.first}}, patient failing</span>
                    {{/if}}
                  {{/if}}
                {{/if}}
              </div>
              <div class="patient-user-icon">
                <i class="fa fa-user" aria-hidden="true"></i><span class="sr-only">{{patient.last}} {{patient.first}}, patient result</span>
              </div>
              <div class="patient-btn">
                <a data-toggle="collapse" data-parent="#sharedResults" href="#toggle{{@cid}}" class="close">
                  <i class="fa fa-lg panel-chevron fa-angle-right expand-result-icon expand-result-icon-{{patient._id}}" aria-hidden="true"></i>
                  <span class="sr-only">{{patient.last}} {{patient.first}}, Toggle Logic Pass/Fail</span>
                </a>
              </div>
              <div class="patient-status status status-{{status}}">
                <span class="sr-only">{{patient.last}} {{patient.first}}, status </span>{{status}}
              </div>
              <div class="patient-name">
                <span class="sr-only">patient name: </span>{{patient.last}} {{patient.first}}
              </div>

            </div>
          </div>
        </div>
        <div id="toggle{{@cid}}" class="panel-collapse collapse">
          <div class="panel-body">
            <div class="meta">
              <p>By user: {{patient.user_id}}</p>
              <p>From measure: {{patient.measure_ids.[0]}}</p>
            </div>
            {{template "population_calculation_results"}}
            {{#button "clonePatient" class="btn btn-primary"}}CLONE<span class="sr-only"> patient {{patient.last}} {{patient.first}}</span>{{/button}}
          </div>
        </div>
      </div>
    {{/collection}}

  </div>
</div>
